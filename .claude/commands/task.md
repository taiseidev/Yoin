---
description: Obsidianのタスクを参照・実装・ステータス更新
---

Obsidianのタスク管理ファイルからタスクを参照し、実装後にステータスを更新します。

使い方:
```
/task                    # すべてのタスクを確認してユーザーに選択させる
/task カメラ実装         # 指定したタスクのみを検索して実装
/task "ルーム作成画面"   # スペースを含むタスク名は引用符で囲む
```

## 実行手順

### 1. タスクの参照

Obsidianのタスク管理ファイルを読み込む:
- ファイルパス: `/Users/t-z/workspace/obsidian-notes/08_個人開発/Yoin. - 余韻 -/タスク管理.md`
- `#task` タグが付いているタスクを抽出
- タスク名、詳細、チェックボックスの状態（`[ ]` または `[x]`）を確認

**引数が指定されている場合:**
- 指定されたタスク名でタスクを検索（部分一致）
- マッチするタスクが複数ある場合は、ユーザーに選択させる
- マッチするタスクがない場合は、エラーを表示して終了

**引数が指定されていない場合:**
- 未完了のタスク（`[ ]`）を一覧表示
- ユーザーに実装するタスクを選択させる

### 2. タスクの実装

選択されたタスクに基づいて実装を行う:

1. **タスク内容の分析**
   - タスクの目的と要件を理解
   - 影響範囲を確認（Domain層、Data層、Presentation層）
   - 必要なファイルや依存関係を特定

2. **実装の計画**
   - TodoWriteツールを使用して実装計画を立てる
   - Clean Architecture + MVIパターンに従った実装ステップを定義
   - 必要に応じてサブタスクに分解

3. **実装の実行**
   - タスクの要件に従ってコードを実装
   - 既存のアーキテクチャとコーディング規約に従う
   - 必要に応じてテストコードも作成

4. **動作確認**
   - ビルドエラーがないか確認
   - 必要に応じて実機/エミュレータで動作確認

### 3. タスクステータスの更新

実装が完了したら、Obsidianのタスク管理ファイルを更新:

1. **チェックボックスの更新**
   - タスクのチェックボックスを `[ ]` から `[x]` に変更
   - Editツールを使用して正確に更新

2. **サブタスクの処理**
   - 親タスクの下にサブタスク（インデントされたチェックボックス）がある場合
   - 該当するサブタスクもチェック済みにする

3. **更新の確認**
   - 更新後のタスク管理ファイルを読み込んで確認
   - ユーザーに完了したタスクを報告

## 重要な注意事項

### アーキテクチャの遵守
- ✅ Clean Architecture（Domain → Data, Presentation → Domain）を守る
- ✅ MVIパターン（Intent → State）に従う
- ✅ Repository Pattern を使用
- ✅ DI（Koin）で依存関係を管理

### コーディング規約
- ✅ PascalCase: クラス、インターフェース、Composable関数
- ✅ camelCase: 関数、変数
- ✅ UPPER_SNAKE_CASE: 定数
- ✅ _camelCase: プライベートStateFlow

### ファイル配置
- Domain層: `shared/src/commonMain/kotlin/com/yoin/domain/`
- Data層: `shared/src/commonMain/kotlin/com/yoin/data/`
- Presentation層: `composeApp/src/commonMain/kotlin/ui/`
- Platform固有: `shared/src/androidMain/` または `shared/src/iosMain/`

### エラーハンドリング
- すべての非同期処理は `Result<T>` でラップ
- Repository層で try-catch を実装
- ViewModelでエラー状態を適切に管理

### テストコード
- 主要なUseCaseのUnit Testを作成
- Repositoryのテストを作成
- 必要に応じてUI Testも作成

## タスク管理ファイルの構造

タスクは以下の形式で記述されています:

```markdown
- [ ] #task タスク名 ⏱️見積もり時間
    - [ ] サブタスク1
    - [ ] サブタスク2
```

完了したタスクは:

```markdown
- [x] #task タスク名 ⏱️見積もり時間
    - [x] サブタスク1
    - [x] サブタスク2
```

## 実装例

### 例1: タスク名を指定して実装

```
/task ルーム作成画面
```

1. タスク管理ファイルから「ルーム作成画面」を検索
2. マッチするタスク（例: `ルーム作成画面（UI）`）を表示
3. ユーザーに確認して実装開始
4. Domain層のモデル → Repository → UseCase → ViewModel → UI の順で実装
5. 実装完了後、タスクのチェックボックスを `[x]` に更新

### 例2: すべてのタスクから選択

```
/task
```

1. 未完了のタスク（`[ ] #task`）をすべて抽出
2. フェーズごとに整理して表示
3. ユーザーに実装するタスクを選択させる
4. 選択されたタスクを実装
5. 完了後、ステータスを更新

## 参考

- [タスク管理ファイル](/Users/t-z/workspace/obsidian-notes/08_個人開発/Yoin. - 余韻 -/タスク管理.md)
- [アーキテクチャ設計](docs/architecture.md)
- [コーディング規約](docs/coding-standards.md)
- [開発ガイドライン](docs/development-guide.md)

## トラブルシューティング

### タスクが見つからない
- タスク名のスペルを確認
- 部分一致で検索されるため、短いキーワードで試す
- 引用符で囲んで正確な名前を指定

### 実装が複雑すぎる
- タスクを分解して段階的に実装
- TodoWriteツールで実装計画を細かく立てる
- 必要に応じてユーザーに確認

### ステータス更新が失敗する
- Obsidianファイルが他のプロセスで開かれていないか確認
- ファイルパスが正しいか確認
- 手動で更新が必要な場合はユーザーに通知
